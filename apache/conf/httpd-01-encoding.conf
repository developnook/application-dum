LoadModule filter_module modules/mod_filter.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule brotli_module modules/mod_brotli.so

# <IfModule mod_deflate.c>
# 	AddOutputFilterByType DEFLATE application/javascript
# 	AddOutputFilterByType DEFLATE application/json
# 	AddOutputFilterByType DEFLATE application/pdf
# 	AddOutputFilterByType DEFLATE application/rss+xml
# 	AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
# 	AddOutputFilterByType DEFLATE application/x-font
# 	AddOutputFilterByType DEFLATE application/x-font-opentype
# 	AddOutputFilterByType DEFLATE application/x-font-otf
# 	AddOutputFilterByType DEFLATE application/x-font-truetype
# 	AddOutputFilterByType DEFLATE application/x-font-ttf
# 	AddOutputFilterByType DEFLATE application/x-javascript
# 	AddOutputFilterByType DEFLATE application/xhtml+xml
# 	AddOutputFilterByType DEFLATE application/xml
# 	AddOutputFilterByType DEFLATE font/opentype
# 	AddOutputFilterByType DEFLATE font/otf
# 	AddOutputFilterByType DEFLATE font/ttf
# 	AddOutputFilterByType DEFLATE image/svg+xml
# 	AddOutputFilterByType DEFLATE image/x-icon
# 	AddOutputFilterByType DEFLATE text/css
# 	AddOutputFilterByType DEFLATE text/html
# 	AddOutputFilterByType DEFLATE text/javascript
# 	AddOutputFilterByType DEFLATE text/plain
# 	AddOutputFilterByType DEFLATE text/xml
# </IfModule>

# <IfModule mod_brotli.c>
# 	AddOutputFilterByType BROTLI_COMPRESS application/javascript
# 	AddOutputFilterByType BROTLI_COMPRESS application/json
# 	AddOutputFilterByType BROTLI_COMPRESS application/pdf
# 	AddOutputFilterByType BROTLI_COMPRESS application/rss+xml
# 	AddOutputFilterByType BROTLI_COMPRESS application/vnd.ms-fontobject
# 	AddOutputFilterByType BROTLI_COMPRESS application/x-font
# 	AddOutputFilterByType BROTLI_COMPRESS application/x-font-opentype
# 	AddOutputFilterByType BROTLI_COMPRESS application/x-font-otf
# 	AddOutputFilterByType BROTLI_COMPRESS application/x-font-truetype
# 	AddOutputFilterByType BROTLI_COMPRESS application/x-font-ttf
# 	AddOutputFilterByType BROTLI_COMPRESS application/x-javascript
# 	AddOutputFilterByType BROTLI_COMPRESS application/xhtml+xml
# 	AddOutputFilterByType BROTLI_COMPRESS application/xml
# 	AddOutputFilterByType BROTLI_COMPRESS font/opentype
# 	AddOutputFilterByType BROTLI_COMPRESS font/otf
# 	AddOutputFilterByType BROTLI_COMPRESS font/ttf
# 	AddOutputFilterByType BROTLI_COMPRESS image/svg+xml
# 	AddOutputFilterByType BROTLI_COMPRESS image/x-icon
# 	AddOutputFilterByType BROTLI_COMPRESS text/css
# 	AddOutputFilterByType BROTLI_COMPRESS text/html
# 	AddOutputFilterByType BROTLI_COMPRESS text/javascript
# 	AddOutputFilterByType BROTLI_COMPRESS text/plain
# 	AddOutputFilterByType BROTLI_COMPRESS text/xml

<IfModule filter_module>

	<IfModule brotli_module>
	# declare a filter for brotli compression
	FilterDeclare  COMPRESS_BR CONTENT_SET
	# only compress certain content types 
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^text/html\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^text/plain\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^text/xml\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^text/css\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^text/javascript\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^text/x-component\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/javascript\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/x-javascript\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/json\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/xml\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/xhtml\+xml\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/rss\+xml\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/atom\+xml\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/vnd\.ms-fontobject\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^image/svg\+xml\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^image/x-icon\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^image/vnd\.microsoft\.icon\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/x-font-ttf\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/font-sfnt\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^application/vnd\.ms-fontobject\b#"
		FilterProvider COMPRESS_BR BROTLI_COMPRESS "%{Content_Type} =~ m#^font/opentype\b#"
		FilterProtocol COMPRESS_BR BROTLI_COMPRESS change=yes;byteranges=no
	</IfModule>

	<IfModule deflate_module>
		<IfModule setenvif_module>
			BrowserMatch ^Mozilla/4 gzip-only-text/html
			BrowserMatch ^Mozilla/4\.0[678] no-gzip
			BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
		</IfModule>
		# declare a filter for deflate/gzip compression
		FilterDeclare  COMPRESS_GZ CONTENT_SET
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^text/html\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^text/plain\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^text/xml\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^text/css\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^text/javascript\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^text/x-component\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/javascript\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/x-javascript\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/json\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/xml\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/xhtml\+xml\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/rss\+xml\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/atom\+xml\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/vnd\.ms-fontobject\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^image/svg\+xml\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^image/x-icon\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^image/vnd\.microsoft\.icon\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/x-font-ttf\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/font-sfnt\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^application/vnd\.ms-fontobject\b#"
		FilterProvider COMPRESS_GZ DEFLATE "%{Content_Type} =~ m#^font/opentype\b#"
		FilterProtocol COMPRESS_GZ DEFLATE change=yes;byteranges=no
		FilterTrace    COMPRESS_GZ 1
	</IfModule>

	# client accepts brotli
	<If "%{HTTP:Accept-Encoding} =~ /\bbr\b/">
		<IfModule brotli_module>
			# we have brotli support
			FilterChain COMPRESS_BR
		</IfModule>
		<IfModule !brotli_module>
			# we do not have brotli support, fallback to deflate if the client supports it
			<If "%{HTTP:Accept-Encoding} =~ /\bdeflate\b/">
				<IfModule deflate_module>
					FilterChain COMPRESS_GZ
				</IfModule>
			</If>
		</IfModule>
	</If>

	# client does not accept brotli, check for deflate support
	<ElseIf "%{HTTP:Accept-Encoding} =~ /\bdeflate\b/">
		<IfModule deflate_module>
			FilterChain COMPRESS_GZ
		</IfModule>
	</ElseIf>

</IfModule>

